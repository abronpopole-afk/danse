appId: com.gtopokerbot.app
productName: GTO Poker Bot
copyright: Copyright © 2024

extraMetadata:
  main: electron/main.cjs
  description: GTO Poker Bot - Advanced poker assistant
  author: GTO Poker Bot

directories:
  output: dist-electron
  buildResources: electron/assets

files:
  - dist/**/*
  - electron/**/*
  - native/build/**/*
  - node_modules/**/*
  - package.json
  - "!**/*.ts"
  - "!**/*.map"
  - "!**/node_modules/*/{CHANGELOG.md,README.md,readme.md}"
  - "!**/node_modules/*/{test,__tests__,tests,powered-test,example,examples}"
  - "!**/node_modules/.cache/**/*"

# Modules natifs à extraire de l'archive asar
# Ces modules contiennent des binaires .node qui doivent être accessibles
asarUnpack:
  - "**/node_modules/robotjs/**/*"
  - "**/node_modules/node-window-manager/**/*"
  - "**/node_modules/screenshot-desktop/**/*"
  - "**/node_modules/extract-file-icon/**/*"
  - "**/node_modules/ref-napi/**/*"
  - "**/node_modules/ffi-napi/**/*"
  # Dépendances requises par les modules natifs
  - "**/node_modules/temp/**/*"
  - "**/node_modules/node-gyp-build/**/*"
  - "**/node_modules/rimraf/**/*"
  - "**/node_modules/glob/**/*"
  - "**/node_modules/os-tmpdir/**/*"
  # Dépendances transitives complètes de glob/rimraf/temp
  - "**/node_modules/inflight/**/*"
  - "**/node_modules/minimatch/**/*"
  - "**/node_modules/fs.realpath/**/*"
  - "**/node_modules/once/**/*"
  - "**/node_modules/path-is-absolute/**/*"
  - "**/node_modules/wrappy/**/*"
  - "**/node_modules/brace-expansion/**/*"
  - "**/node_modules/balanced-match/**/*"
  - "**/node_modules/concat-map/**/*"
  - "**/node_modules/inherits/**/*"           # Dépendance de util/rimraf
  - "**/node_modules/util/**/*"               # Node.js util polyfill

extraResources:
  - from: native/build/Release/
    to: native/
    filter:
      - "*.node"

win:
  target:
    - target: nsis
      arch: x64
    - target: portable
      arch: x64
  icon: electron/assets/icon.ico
  requestedExecutionLevel: asInvoker

nsis:
  oneClick: false
  perMachine: false
  allowElevation: true
  allowToChangeInstallationDirectory: true
  installerIcon: electron/assets/icon.ico
  uninstallerIcon: electron/assets/icon.ico
  installerHeaderIcon: electron/assets/icon.ico
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: GTO Poker Bot
  license: LICENSE
  include: electron/installer.nsh

portable:
  artifactName: "${productName}-${version}-portable.exe"

publish:
  provider: github
  owner: bobibobini1-cell
  repo: gto-poker-bot
  releaseType: draft
  publishAutoRelease: true

asar: true
compression: maximum

nodeGypRebuild: false
npmRebuild: true

electronDownload:
  cache: .cache/electron

afterPack: ./electron/scripts/after-pack.cjs
